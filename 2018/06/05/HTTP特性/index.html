<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>HTTP特性 | Shirmy</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">HTTP特性</h1><a id="logo" href="/.">Shirmy</a><p class="description">From small beginnings comes great things.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">HTTP特性</h1><div class="post-meta">Jun 5, 2018<span> | </span><span class="category"><a href="/categories/HTTP/">HTTP</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2018/06/05/HTTP特性/" href="/2018/06/05/HTTP特性/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP客户端"><span class="toc-number">1.</span> <span class="toc-text">HTTP客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS跨域请求的限制与解决"><span class="toc-number">2.</span> <span class="toc-text">CORS跨域请求的限制与解决</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS跨域限制以及预请求验证"><span class="toc-number">3.</span> <span class="toc-text">CORS跨域限制以及预请求验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#允许的方法"><span class="toc-number">3.1.</span> <span class="toc-text">允许的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#允许的Content-Type"><span class="toc-number">3.2.</span> <span class="toc-text">允许的Content-Type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其它限制"><span class="toc-number">3.3.</span> <span class="toc-text">其它限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预请求"><span class="toc-number">3.4.</span> <span class="toc-text">预请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存头Cache-Control的含义和使用"><span class="toc-number">4.</span> <span class="toc-text">缓存头Cache-Control的含义和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可缓存性"><span class="toc-number">4.1.</span> <span class="toc-text">可缓存性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#no-store"><span class="toc-number">4.2.</span> <span class="toc-text">no-store</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#no-transform"><span class="toc-number">4.3.</span> <span class="toc-text">no-transform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#max-age"><span class="toc-number">4.4.</span> <span class="toc-text">max-age</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存验证Last-Modified和Etag的使用"><span class="toc-number">5.</span> <span class="toc-text">缓存验证Last-Modified和Etag的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证头-Last-Modified"><span class="toc-number">5.1.</span> <span class="toc-text">验证头(Last-Modified)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证头-Etag"><span class="toc-number">5.2.</span> <span class="toc-text">验证头(Etag)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#演示"><span class="toc-number">5.3.</span> <span class="toc-text">演示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie和session"><span class="toc-number">6.</span> <span class="toc-text">cookie和session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie"><span class="toc-number">6.1.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Session"><span class="toc-number">6.2.</span> <span class="toc-text">Session</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP长连接"><span class="toc-number">7.</span> <span class="toc-text">HTTP长连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据协商"><span class="toc-number">8.</span> <span class="toc-text">数据协商</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#请求-Accept"><span class="toc-number">8.1.</span> <span class="toc-text">请求(Accept)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#响应-Content"><span class="toc-number">8.2.</span> <span class="toc-text">响应(Content)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redirect"><span class="toc-number">9.</span> <span class="toc-text">Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Content-Security-Policy-CSP"><span class="toc-number">10.</span> <span class="toc-text">Content-Security-Policy(CSP)</span></a></li></ol></div></div><div class="post-content"><p>HTTP客户端、CORS跨域请求的限制与解决、CORS跨域限制以及预请求验证、缓存头Cache-Control的含义和使用、缓存验证Last-Modified和Etag的使用、cookie和session、HTTP长连接、数据协商、Redirect、Content-Security-Policy(CSP)</p>
<a id="more"></a>
<h2 id="HTTP客户端"><a href="#HTTP客户端" class="headerlink" title="HTTP客户端"></a>HTTP客户端</h2><p>mac下使用curl命令发起http请求，curl -v获取详细的http请求信息</p>
<h2 id="CORS跨域请求的限制与解决"><a href="#CORS跨域请求的限制与解决" class="headerlink" title="CORS跨域请求的限制与解决"></a>CORS跨域请求的限制与解决</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="actionscript">  xhr.open(<span class="string">'GET'</span>, <span class="string">'http://127.0.0.1:8887/'</span>)</span></span><br><span class="line"><span class="undefined">  xhr.send()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如上代码所示，请求8887端口，如果服务端没有设置Access-Control-Allow-Origin，就会有跨域的问题，这个请求实际上已经发送，而且内容也有返回，但是浏览器会发现这个请求是不允许的，那么浏览器会拦截掉，这是浏览器提供的功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server2.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'request come'</span>, request.url)</span><br><span class="line"></span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="comment">// 允许 http://127.0.0.1:8888 的跨服务请求 '*' 允许任何</span></span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'http://127.0.0.1:8888'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  response.end(<span class="string">'123'</span>)</span><br><span class="line">&#125;).listen(<span class="number">8887</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server listening on 8887'</span>)</span><br></pre></td></tr></table></figure>
<p>在8888端口发送的请求，必须是同域的，除非服务器同意了，才能发送出请求。</p>
<p>浏览器允许script、img、link标签来允许跨域，不在乎浏览器是否拒绝跨域，因此我们可以利用这些标签来完成跨域，如下代码所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1:8887/"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>jsonp的原理就是script里加载一个链接，这个链接去访问服务器的某一个请求，并且返回内容，返回的内容的代码是一段可执行的代码，然后调用jsonp设置的内容。这样就可以达到目的。</p>
<h2 id="CORS跨域限制以及预请求验证"><a href="#CORS跨域限制以及预请求验证" class="headerlink" title="CORS跨域限制以及预请求验证"></a>CORS跨域限制以及预请求验证</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">  fetch(<span class="string">'http://localhost:8887'</span>, &#123;</span></span><br><span class="line"><span class="actionscript">    method: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="undefined">    headers: &#123;</span></span><br><span class="line"><span class="actionscript">      <span class="string">'X-Test-Cors'</span>: <span class="string">'123'</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8887 设置</span></span><br><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>浏览器报错：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to <span class="keyword">load</span> <span class="keyword">http</span>://localhost:<span class="number">8887</span>/: Request header <span class="keyword">field</span> X-<span class="keyword">Test</span>-Cors <span class="keyword">is</span> <span class="keyword">not</span> allowed <span class="keyword">by</span> <span class="keyword">Access</span>-Control-<span class="keyword">Allow</span>-Headers <span class="keyword">in</span> preflight response.</span><br></pre></td></tr></table></figure>
<h3 id="允许的方法"><a href="#允许的方法" class="headerlink" title="允许的方法"></a>允许的方法</h3><p>GET、HEAD、POST</p>
<p>这三个方法不需要预请求，其它都需要预请求</p>
<h3 id="允许的Content-Type"><a href="#允许的Content-Type" class="headerlink" title="允许的Content-Type"></a>允许的Content-Type</h3><p>text/plain</p>
<p>multipart/form-data</p>
<p>application/x-www-form-urlencoded</p>
<p>上面三种是form表单需要设置的三种数据类型</p>
<p>除了这三种content-type类型，其它content-type都需要预请求才能进行发送</p>
<h3 id="其它限制"><a href="#其它限制" class="headerlink" title="其它限制"></a>其它限制</h3><p>请求头限制：<a href="https://fetch.spec.whatwg.org/" target="_blank" rel="noopener">https://fetch.spec.whatwg.org/</a></p>
<p>XMLHttpRequestUpload对象均没有注册任何事件监听器(少用)</p>
<p>请求头中没有使用ReadableStrem对象(少用)</p>
<h3 id="预请求"><a href="#预请求" class="headerlink" title="预请求"></a>预请求</h3><p>实际上请求已经发送，而且是200 OK，数据是有返回的，只是跟之前一样，浏览器把请求忽略掉了。</p>
<p>浏览器是根据Header来判断的</p>
<p>如果要允许发送，需要告诉浏览器，如下代码所示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8887 设置</span></span><br><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>,</span><br><span class="line">    <span class="comment">// 允许自定义的头 X-Test-Cors</span></span><br><span class="line">    <span class="string">'Access-Control-Allow-Headers'</span>: <span class="string">'X-Test-Cors'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时有两个请求，首先发送一个Request Method: OPTIONS作为预请求，用于告诉浏览器接下来的POST请求是允许的，这就是浏览器关于预请求的操作</p>
<p>允许请求的方法，如下代码所示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8887</span></span><br><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'*'</span>,</span><br><span class="line">    <span class="string">'Access-Control-Allow-Headers'</span>: <span class="string">'X-Test-Cors'</span>,</span><br><span class="line">    <span class="comment">// 突破 PUT、DELETE 请求的限制</span></span><br><span class="line">    <span class="string">'Access-Control-Allow-Methods'</span>: <span class="string">'PUT, DELETE'</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>浏览器之所以这么做，希望进行跨域操作的时候来保证服务端的安全，不会因为一些跨域的请求导致服务端数据被而已的篡改，因此通过设置一些参数来判断是否要响应</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 8887</span></span><br><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Access-Control-Allow-Origin'</span>: <span class="string">'http://127.0.0.1:8888'</span>,</span><br><span class="line">    <span class="string">'Access-Control-Allow-Headers'</span>: <span class="string">'X-Test-Cors'</span>,</span><br><span class="line">    <span class="string">'Access-Control-Allow-Methods'</span>: <span class="string">'POST, PUT, DELETE'</span>,</span><br><span class="line">    <span class="comment">// 允许以上面方式的请求在1000s内不需要再进行跨域请求，直接正式请求即可</span></span><br><span class="line">    <span class="comment">// 此时1000s内不会有 OPTION 了</span></span><br><span class="line">    <span class="string">'Access-Control-Max-Age'</span>: <span class="string">'1000'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果要进行跨域请求，就要考虑如何配置以上的限制</p>
<h2 id="缓存头Cache-Control的含义和使用"><a href="#缓存头Cache-Control的含义和使用" class="headerlink" title="缓存头Cache-Control的含义和使用"></a>缓存头Cache-Control的含义和使用</h2><h3 id="可缓存性"><a href="#可缓存性" class="headerlink" title="可缓存性"></a>可缓存性</h3><p>public(http经过的任何节点都进行缓存)</p>
<p>private(只有发起请求的浏览器进行缓存)</p>
<p>no-cache(任何一个节点都不可以进行缓存)</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 缓存的过期时间，过期后浏览器再发送请求</span><br><span class="line"><span class="built_in">max</span>-age=&lt;<span class="built_in">seconds</span>&gt;</span><br><span class="line">// 如果在代理服务器中设置了<span class="built_in">max</span>-age和s-maxage两条，那么会读取s-maxage</span><br><span class="line">s-maxage=&lt;<span class="built_in">seconds</span>&gt;</span><br><span class="line">// <span class="built_in">max</span>-stale是发起请求的这一方主动带的头，代表即便缓存过期了，但是只要在<span class="built_in">max</span>-stale内还可以使用过期缓存，而不需要去原服务器请求新的请求</span><br><span class="line">// <span class="built_in">max</span>-stale只有在发起端才有用，服务端设置没有用</span><br><span class="line"><span class="built_in">max</span>-stale=&lt;<span class="built_in">seconds</span>&gt;</span><br><span class="line">// 在设置了<span class="built_in">max</span>-age的缓存当中，如果已经过期了，那么必须去原服务端发送这个请求，重新获取数据来验证是否真的过期了，而不能直接使用本地的缓存(少用)</span><br><span class="line">must-revalidate</span><br><span class="line">// 用在缓存服务器中，缓存服务器必须要去原服务器重新请求一遍，而不能使用本地的缓存(少用)</span><br><span class="line">proxy-revalidate</span><br></pre></td></tr></table></figure>
<h3 id="no-store"><a href="#no-store" class="headerlink" title="no-store"></a>no-store</h3><p>no-cache是可以在本地进行一个缓存，可以在proxy服务器进行缓存，每次发起请求都要到服务器进行验证，如果服务器返回的请求可以使用本地的缓存才可以使用缓存。需要进行服务端的验证。</p>
<p>no-cache就是本地可以存缓存，但是这个缓存需要经过服务器验证才可以使用。</p>
<p>no-store则是本地和代理服务器都不可能存储缓存，都必须要到服务器拿新的内容。</p>
<h3 id="no-transform"><a href="#no-transform" class="headerlink" title="no-transform"></a>no-transform</h3><p>用在proxy服务器上，用来禁止proxy服务器上的一些压缩和转换</p>
<hr>
<p>上面这些头只是限制性、声明性的作用，而没有强制性的约束力，实际上可以完全不按照这个规范来做。</p>
<p><strong>浏览器中用到的：</strong></p>
<p>public、private、no-cache、max-age、must-revalidate(可能用到)</p>
<h3 id="max-age"><a href="#max-age" class="headerlink" title="max-age"></a>max-age</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'request come'</span>, request.url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (request.url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> html = fs.readFileSync(<span class="string">'test.html'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(html)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (request.url === <span class="string">'/script.js'</span>) &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span>,</span><br><span class="line">      <span class="comment">// 设置 max-age 为 20s</span></span><br><span class="line">      <span class="string">'Cache-Control'</span>: <span class="string">'max-age=20'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(<span class="string">'console.log("script loaded")'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server listening on 8888'</span>)</span><br></pre></td></tr></table></figure>
<p>设置cache-control为20s</p>
<p>此时返回的文件的headers的Response Headers中多了一条Cache-Control: max-age=20</p>
<p>取消Disable cache的勾选，然后刷新，此时Size就会显示(from memory cache)，此时就能直接从缓存中读</p>
<hr>
<p>改变console的内容，然后在20s内进行刷新，如下代码所示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 后面加上了 twice</span></span><br><span class="line">response.end(<span class="string">'console.log("script loaded twice")'</span>)</span><br></pre></td></tr></table></figure>
<p>因为url没有变，因此还是从缓存中读，而没有读取新的脚本，客户端不知道服务端已经更新了，没有即时更新到客户端</p>
<p>解决方案(构建时加上哈希)：</p>
<p>常见的解决方案就是在构建流程中，在打包完成的文件名上加上哈希码，因为是根据内容进行哈希计算，如果内容没有变，那么哈希就没有变，那么url就没有变。如果有变则url有变，那么就是一个新的静态资源请求。</p>
<hr>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以通过逗号设置多个</span></span><br><span class="line"><span class="string">'Cache-Control'</span>: <span class="string">'max-age=20, public'</span></span><br></pre></td></tr></table></figure>
<h2 id="缓存验证Last-Modified和Etag的使用"><a href="#缓存验证Last-Modified和Etag的使用" class="headerlink" title="缓存验证Last-Modified和Etag的使用"></a>缓存验证Last-Modified和Etag的使用</h2><p><img src="/2018/06/05/HTTP特性/cache.png" alt="HTTP缓存过程"></p>
<p>浏览器 -&gt; 本地缓存 -&gt; 代理缓存 -&gt; 服务器</p>
<h3 id="验证头-Last-Modified"><a href="#验证头-Last-Modified" class="headerlink" title="验证头(Last-Modified)"></a>验证头(Last-Modified)</h3><p>上次修改时间</p>
<p>配合If-Modified-Since或者If-Unmodified-Since使用</p>
<h3 id="验证头-Etag"><a href="#验证头-Etag" class="headerlink" title="验证头(Etag)"></a>验证头(Etag)</h3><p>数据签名(对数据产生唯一的签名，如文件名的哈希计算)</p>
<p>配合If-Match或者If-Non-Match使用</p>
<p>对比资源的签名判断是否使用缓存</p>
<h3 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span>,</span><br><span class="line">    <span class="comment">// 不进行缓存</span></span><br><span class="line">    <span class="string">'Cache-Control'</span>: <span class="string">'max-age=2000000, no-cache'</span>,</span><br><span class="line">    <span class="string">'Last-Modified'</span>: <span class="string">'123'</span>,</span><br><span class="line">    <span class="string">'Etag'</span>: <span class="string">'777'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>设置了Last-Modified和Etag之后，在下次请求，浏览器就会验证缓存的头，现在服务器仍然会把数据返回到浏览器，因此可以进行以下设置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取 etag 的值</span></span><br><span class="line"><span class="keyword">const</span> etag = request.headers[<span class="string">'if-none-match'</span>]</span><br><span class="line"><span class="keyword">if</span> (etag === <span class="string">'777'</span>) &#123;</span><br><span class="line">    response.writeHead(<span class="number">304</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span>,</span><br><span class="line">        <span class="string">'Cache-Control'</span>: <span class="string">'max-age=2000000, no-cache'</span>,</span><br><span class="line">        <span class="string">'Last-Modified'</span>: <span class="string">'123'</span>,</span><br><span class="line">        <span class="string">'Etag'</span>: <span class="string">'777'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/javascript'</span>,</span><br><span class="line">        <span class="string">'Cache-Control'</span>: <span class="string">'max-age=2000000, no-cache'</span>,</span><br><span class="line">        <span class="string">'Last-Modified'</span>: <span class="string">'123'</span>,</span><br><span class="line">        <span class="string">'Etag'</span>: <span class="string">'777'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(<span class="string">'console.log("script loaded twice")'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果设置了no-store，即便没有勾选Disable cache还是会忽略任何跟缓存有关的信息</p>
<p>可以通过验证数据库中的updateAt来进行验证Last-Modifined，如果是服务器端，可以给读取到的数据进行签名，用来跟接收的请求的签名进行对比</p>
<h2 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h2><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>通过Set-Cookie设置</p>
<p>下次请求会自动带上</p>
<p>键值对，可以设置多个</p>
<p>属性：</p>
<p>max-age和expires设置过期时间</p>
<p>Secure值在https的时候才会发送</p>
<p>HttpOnly无法通过document.cookie访问(安全性考虑)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = fs.readFileSync(<span class="string">'test.html'</span>, <span class="string">'utf8'</span>)</span><br><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="comment">// 通过数组设置多个 cookie</span></span><br><span class="line">    <span class="comment">// max-age 设置过期时间是多少秒</span></span><br><span class="line">    <span class="comment">// expires 代表到哪个时间点过期</span></span><br><span class="line">    <span class="comment">// abc=456; httpOnly 可以用于禁止javascript访问cookie</span></span><br><span class="line">    <span class="comment">// domain 用来设置访问域的权限</span></span><br><span class="line">    <span class="comment">// 在同一个主域名下，子域名是可以共享cookie的</span></span><br><span class="line">    <span class="string">'Set-Cookie'</span>: [<span class="string">'id=123; max-age=2'</span>, <span class="string">'abc=456;domain=test.com'</span>]</span><br><span class="line">&#125;)</span><br><span class="line">response.end(html)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="built_in">document</span>.cookie)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置的cookie是有过期时间的，如果没有设置过期时间，那么在关闭浏览器的时候会清除掉。</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>cookie 不等于 session</p>
<p>session 也有很多种实现方法，只是在网站开发中经常使用 cookie 来设置 session</p>
<p>比如使用cookie把用户的id设置到cookie中，通过读取用户对唯一的key来定位用户的信息，用来保证定位到用户的信息就是session的实现</p>
<h2 id="HTTP长连接"><a href="#HTTP长连接" class="headerlink" title="HTTP长连接"></a>HTTP长连接</h2><p>可以避免多次重复进行三次握手</p>
<p>在chrome的Nerwork选项中观察Connection id来判断是否同一个连接</p>
<p>在Headers中观察connection字段是否keep-Alive(长连接)</p>
<p>Chrome最多可以六个并发的连接</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> html = fs.readFileSync(<span class="string">'test.html'</span>, <span class="string">'utf8'</span>)</span><br><span class="line"><span class="keyword">const</span> img = fs.readFileSync(<span class="string">'test.jpg'</span>)</span><br><span class="line">    <span class="keyword">if</span> (request.url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(html)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'image/jpg'</span>,</span><br><span class="line">        <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span> <span class="comment">// or 'close'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(img)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数据协商"><a href="#数据协商" class="headerlink" title="数据协商"></a>数据协商</h2><p>数据协商就是客户端发送请求的时候，客户端会声明希望拿到的格式或限制是怎样的，服务端根据请求的要求返回不同类型的数据，服务端根据头信息进行区分</p>
<p><img src="/2018/06/05/HTTP特性/Accept.png" alt="Accept"></p>
<h3 id="请求-Accept"><a href="#请求-Accept" class="headerlink" title="请求(Accept)"></a>请求(Accept)</h3><p>Accept(<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types" target="_blank" rel="noopener">Content-type</a>)</p>
<p>Accept-Encoding(压缩算法gzip/deflate/br)</p>
<p>Accept-Language(q的值是权重)</p>
<p>User-Agent(客户端环境)</p>
<h3 id="响应-Content"><a href="#响应-Content" class="headerlink" title="响应(Content)"></a>响应(Content)</h3><p>Content-Type</p>
<p>Content-Encoding(对应Accept-Encoding)</p>
<p>Content-Language</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'request come'</span>, request.url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> html = fs.readFileSync(<span class="string">'test.html'</span>)</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="comment">// 服务器用来提示客户端一定要遵循在Content-Type 首部中对MIME类型的设定，而不能对其进行修改。</span></span><br><span class="line">    <span class="comment">// 'X-Content-Options': 'nosniff'</span></span><br><span class="line">    <span class="string">'Content-Encoding'</span>: <span class="string">'gzip'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  response.end(zlib.gzipSync(html))</span><br><span class="line">&#125;).listen(<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--enctype规定如何进行编码--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--multipart/form-data分成不同的部分--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/form"</span> <span class="attr">id</span>=<span class="string">"form"</span> <span class="attr">enctype</span>=<span class="string">"application/x-www-form-urlencoded"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h2><p>如果已经指定了某个地方，但是资源换了一个地方，那么通过redirect告诉客户端去哪里获取这个资源，如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">if</span> (request.url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="comment">// 302 代表临时跳转，而非永久跳转，需要服务端进行一次跳转</span></span><br><span class="line">    <span class="comment">// 301 代表永久跳转到 /new，不再需要请求服务器，浏览器会尽可能长的去缓存这个请求，除非手动清除(慎重选择，用户可能不清缓存)</span></span><br><span class="line">    response.writeHead(<span class="number">302</span>, &#123;  <span class="comment">// or 301</span></span><br><span class="line">        <span class="comment">// 重定向到新的url，因为是同域，因此不需要写域名和端口</span></span><br><span class="line">        <span class="string">'Location'</span>: <span class="string">'/new'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (request.url === <span class="string">'/new'</span>) &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(<span class="string">'&lt;div&gt;this is content&lt;/div&gt;'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时访问localhost:8888会直接访问到localhost:8888/new</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 301 跳转情况</span></span><br><span class="line">request come /</span><br><span class="line">request come /<span class="keyword">new</span><span class="type"></span></span><br><span class="line"><span class="type"></span>// <span class="number">302</span> 跳转情况</span><br><span class="line">request come /<span class="keyword">new</span><span class="type"></span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/06/05/HTTP特性/redirect.png" alt="HTTP重定向"></p>
<h2 id="Content-Security-Policy-CSP"><a href="#Content-Security-Policy-CSP" class="headerlink" title="Content-Security-Policy(CSP)"></a>Content-Security-Policy(CSP)</h2><p>内容安全策略</p>
<p>限制资源获取</p>
<p>报告资源获取越权</p>
<p>default-src限制全局连接的作用范围</p>
<p>制定资源类型(connect-src、img-src、manifest-src、font-src、media-src、script-src、frame-src、style-src…)</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 只能通过 <span class="keyword">http</span> 或 <span class="keyword">https</span></span><br><span class="line"><span class="string">'Content-Security-Policy'</span>: <span class="string">'default-src http: https:'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只能加载本域名的</span></span><br><span class="line"><span class="string">'Content-Security-Policy'</span>: <span class="string">'default-src \'</span><span class="keyword">self</span>\<span class="string">''</span></span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限制只能是某域名</span></span><br><span class="line"><span class="string">'Content-Security-Policy'</span>: <span class="string">'script-src \'</span><span class="keyword">self</span>\<span class="string">' https://cdn.bootcss.com/'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果要限制form表单的跳转，要单独设置提交的范围</span></span><br><span class="line"><span class="string">'Content-Security-Policy'</span>: <span class="string">'script-src \'</span><span class="keyword">self</span>\<span class="string">'; form-action \'</span><span class="keyword">self</span>\<span class="string">''</span></span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// report 请求，帮助分析整体的安全情况</span></span><br><span class="line"><span class="string">'Content-Security-Policy'</span>: <span class="string">'script-src \'</span><span class="keyword">self</span>\<span class="string">'; form-action \'</span><span class="keyword">self</span>\<span class="string">'; report-uri /report'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 浏览器检测到<span class="keyword">report</span>，但仍然允许加载</span><br><span class="line"><span class="symbol">'Content</span>-Security-Policy-<span class="keyword">Report</span>-Only': <span class="symbol">'script</span>-src \<span class="symbol">'self\'</span>; form-action \<span class="symbol">'self\'</span>; <span class="keyword">report</span>-uri /<span class="keyword">report</span>'</span><br></pre></td></tr></table></figure>
<p><img src="/2018/06/05/HTTP特性/report.png" alt="report"></p>
<p>可以通过<strong>meta</strong>标签来写，如下代码所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Security-Policy"</span> <span class="attr">content</span>=<span class="string">"script-src 'self'; form-action 'self';"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>外链：<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/CSP" target="_blank" rel="noopener">内容安全策略 (CSP)</a></p>
</div><div class="tags"><a href="/tags/Learning/">Learning</a><a href="/tags/HTTP/">HTTP</a></div><div class="post-nav"><a class="pre" href="/2018/06/06/Nginx代理及HTTP2/">Nginx代理及HTTP2</a><a class="next" href="/2018/06/05/HTTP协议简介/">HTTP协议简介</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'qiushiming';
var disqus_identifier = '2018/06/05/HTTP特性/';
var disqus_title = 'HTTP特性';
var disqus_url = 'http://shirmy.me/2018/06/05/HTTP特性/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//qiushiming.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://shirmy.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/Node-js/">Node.js</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/Node-js/Translation/">Translation</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/designPattern/">designPattern</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Koa/">Koa</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Koa/Node-js/">Node.js</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Poetry/">Poetry</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Webpack/">Webpack</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/Life/" style="font-size: 15px;">Life</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/Learning/" style="font-size: 15px;">Learning</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/designPattern/" style="font-size: 15px;">designPattern</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Trying/" style="font-size: 15px;">Trying</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/Event-Loop/" style="font-size: 15px;">Event Loop</a> <a href="/tags/learning/" style="font-size: 15px;">learning</a> <a href="/tags/Webpack/" style="font-size: 15px;">Webpack</a> <a href="/tags/Teaching/" style="font-size: 15px;">Teaching</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/Koa/" style="font-size: 15px;">Koa</a> <a href="/tags/poetry/" style="font-size: 15px;">poetry</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/04/面向对象的JavaScript/">面向对象的JavaScript</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/04/webpack4/">webpack4</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/12/从Angular4升级到Angular6/">从Angular4升级到Angular6</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/01/2018年上半年总结/">2018年上半年总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/08/深入理解koa原理/">深入理解koa中间件原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/06/Nginx代理及HTTP2/">Nginx代理及HTTP2</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/05/HTTP特性/">HTTP特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/05/HTTP协议简介/">HTTP协议简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/01/javascript处理异步的三种方式/">javascript处理异步的三种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/23/webpack-多页面应用/">webpack-多页面应用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//qiushiming.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Shirmy.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>